---
- name: Update apt cache
  ansible.builtin.apt:
    update_cache: yes
  when: action | default('') == 'install' or action is not defined

- ansible.builtin.include_tasks: ./jdk21.yml
  tags: ['jdk21']

- ansible.builtin.include_tasks: ./net-tools.yml
  tags: ['net-tools']

- ansible.builtin.include_tasks: ./jenkins.yml
  tags: ['jenkins']

- name: Fix broken dependencies with apt-get
  ansible.builtin.apt:
    state: present
  when: action | default('') == 'install' or action is not defined

- name: Ensure Jenkins service is running and enabled
  ansible.builtin.service:
    name: jenkins
    state: started
  when: action | default('') == 'install' or action is not defined

- ansible.builtin.include_tasks: ./plugins.yml
  tags: ['plugins']